{% extends "layout.html" %}

{% block content %}
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ventas_admin.css') }}">
</head>

<div class="ventas-container">
    <h2 class="titulo-ventas">üìë Ventas registradas</h2>

    <!-- FILTROS -->
    <form class="form-filtros" method="GET" action="{{ url_for('ventas_admin') }}">
        <label for="cobrador">Cobrador:</label>
        <select name="id_cobrador" id="cobrador">
            <option value="">Todos</option>
            {% for cobrador in cobradores %}
                <option value="{{ cobrador.id }}"
                    {% if request.args.get('id_cobrador') == cobrador.id|string %}selected{% endif %}>
                    {{ cobrador.nombre }} {{ cobrador.apellido }}
                </option>
            {% endfor %}
        </select>

        <label for="fecha_inicio">Desde:</label>
        <input type="date" name="fecha_inicio" id="fecha_inicio" value="{{ request.args.get('fecha_inicio', '') }}">

        <label for="fecha_fin">Hasta:</label>
        <input type="date" name="fecha_fin" id="fecha_fin" value="{{ request.args.get('fecha_fin', '') }}">

        <button type="submit" class="btn-filtrar">üîç Filtrar</button>
    </form>

    <!-- TABLA -->
    <table class="tabla-ventas">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Producto</th>
                <th>Vendedor</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Cobrador</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
        {% for venta in ventas %}
            <tr>
                <td>{{ venta.cliente_nombre }} {{ venta.cliente_apellido }}</td>
                <td>{{ venta.producto_nombre }}</td>
                <td>{{ venta.vendedor_nombre }} {{ venta.vendedor_apellido }}</td>
                <td>{{ venta.fecha_venta }}</td>
                <td>{{ venta.hora }}</td>
                <td>
                    {% if venta.cobrador_nombre %}
                        {{ venta.cobrador_nombre }} {{ venta.cobrador_apellido }}
                    {% else %}
                        <form class="form-asignacion" method="POST" action="{{ url_for('ventas_admin') }}">
                            <input type="hidden" name="id_factura" value="{{ venta.id_factura_venta }}">
                            <select class="select-cobrador" name="id_cobrador" required>
                                <option value="" disabled selected>Seleccionar cobrador</option>
                                {% for cobrador in cobradores %}
                                <option value="{{ cobrador.id }}">{{ cobrador.nombre }} {{ cobrador.apellido }}</option>
                                {% endfor %}
                            </select>
                            <button class="btn-asignar" type="submit">Asignar</button>
                        </form>
                    {% endif %}
                </td>
                <td>
                    {% if not venta.cobrador_nombre %}
                        <span class="estado-sin-cobrador">‚ö†Ô∏è Sin cobrador asignado</span>
                    {% else %}
                        <span class="estado-con-cobrador">‚úÖ Cobrador asignado</span>
                    {% endif %}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7" style="text-align: center;">No se encontraron ventas con esos filtros</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
